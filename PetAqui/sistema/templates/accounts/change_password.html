{%extends 'bases/base.html' %}
{% load static %}
{% load bootstrap %}
{% load widget_tweaks %}
{% load crispy_forms_tags %}
{% block main %}

<div class="card text-white bg-primary">
<div class="card-header"><p class="card-text">
      <small class="text-muted">
         <a href="{% url 'sistema_index' %}" class="text-white ">Home /</a>  
         <a href="{% url 'sistema_perfil' %}" class="text-white ">Perfil /</a>  
         <a class="text-white">Trocar senha </a>
      </small></a></p> 
</div>
<div class="card title  ">
<div class="card-body text-secondary">
    <form method="post">
         {% csrf_token %}
      <div class="form-row"> 
                  <div class="form-group col-md-6">
                              {{ form.old_password | as_crispy_field}}
                        </div>
                        
                        <div class="form-row"> 
            <div class="form-group col-md-6">
           
              {{ form.new_password1 | as_crispy_field}}
               </div>
                <div class="form-group col-md-6">
            
               {{ form.new_password2 | as_crispy_field}}
               <div id="divCheckPassword"></div>
               <div id="divCheckPassword2"></div>
               
              
               </div>
            </div>
               </div>
               <button type="submit"  class="btn btn-primary btn-block">Mudar</button>
               
      </form>
      <br>
      <div class="row"> 
            <div class="form-group col-md-1">
                  <a class="btn btn-light float-left" href="sistema_perfil" role="button">Voltar</a>
      
   </div>
   <div class="form-group col-md-2">
         <a class="btn btn-light" href="/accounts/password_reset/" role="button">Esqueci minha senha</a>

</div>
</div>
      {% if messages %}
      <ul class="messages">
        {% for message in messages %}
          <li class="{{ message.tags }}">{{ message }}</li>
        {% endfor %}
      </ul>
    {% endif %}
      
    

</div>
</div>
</div>

<script>
            $(function(){
               // declaro variáveis de controle
               var val_email, val_email2, val_senha, val_senha2;
               
               function valida(){
                  
                  $('#validator')
                  .prop('disabled', val_email && val_email2 && val_senha && val_senha2 ? false : true);
                  
               }
               function isValidEmailAddress(emailAddress) {
                  var pattern = new RegExp(/^(("[\w-\s]+")|([\w-]+(?:\.[\w-]+)*)|("[\w-\s]+")([\w-]+(?:\.[\w-]+)*))(@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$)|(@\[?((25[0-5]\.|2[0-4][0-9]\.|1[0-9]{2}\.|[0-9]{1,2}\.))((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\.){2}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\]?$)/i);
                  return pattern.test(emailAddress);
               }
               function validarEmail(){
              
                  var email = $("#email").val().trim();
                  var email2 = $("#email2").val().trim();
                  // só irá verificar se os campos tiverem algo  
                  if(email && email2){
                     if(email != email2){
                        $("#message")
                        .html("Os emails não são idênticos")
                        .css('color', 'red');
                        val_email = false;
                     }else{
                        $("#message")
                        .html("Os emails são idênticos")
                        .css('color', 'green');
                        val_email = true;
                     }
                     
                     if(isValidEmailAddress(email)){
                        $("#message2")
                        .html("E-mail válido")
                        .css('color', 'green');
                        val_email2 = true;
                     }else{
                        $("#message2")
                        .html("E-mail inválido")
                        .css('color', 'red');
                        val_email2 = false;
                     }
                     // chama a função de controle do botão
                     valida();
                  }
               }
               function validarSenha(){
                  var senha = $("#id_new_password1").val();
                  var senha2 = $("#id_new_password2").val();
                  // só irá verificar se os campos tiverem algo
                  if(senha && senha2){
                
                     if(senha.length < 8 || senha.length > 16){
               
                        $("#divCheckPassword2")
                        .html("As senhas precisam ter no mínimo 8 caracteres e no máximo 16")
                        .css('color', 'red');
                        val_senha = false;
               
                     }else{
               
                        $("#divCheckPassword2")
                        .html("")
                        .css('color', 'green');
                        val_senha = true;
               
                     }
                   
                     if(senha != senha2){
               
                        $("#divCheckPassword")
                        .html("As senhas não são iguais")
                        .css('color', 'red');
                        val_senha2 = false;
               
                     }else{
               
                        $("#divCheckPassword").html("Senhas idênticas")
                        .css('color', 'green');
                        val_senha2 = true;
                     }
                     
                     // chama a função de controle do botão
                     valida();
                  }
               }
              
               $('#email, #email2').on('keyup', validarEmail);
               $('#id_new_password1, #id_new_password2').on('keyup', validarSenha);
            });
            </script>
            
{% endblock %}

{% block rightcol %}
{% include 'bases/rightcol.html' %}
{% endblock %}

{% block footer %}
{% include 'bases/footer.html' %}
{% endblock %}

